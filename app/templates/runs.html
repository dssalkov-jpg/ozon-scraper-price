{% extends "layout.html" %}
{% block content %}
<h2>üöÄ Runs (–∑–∞–ø—É—Å–∫–∏ —Å–±–æ—Ä–∞ —Ü–µ–Ω)</h2>

<div class="card">
  <h3>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä</h3>
  {% if regions %}
  <form method="post" action="/runs/start">
    <div class="form-group">
      <label>–ü—Ä–æ—Ñ–∏–ª—å —Ä–µ–≥–∏–æ–Ω–∞</label>
      <select name="region_profile_id">
        {% for r in regions %}
          <option value="{{r.id}}">{{r.name}}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å</button>
  </form>
  <p class="muted" style="margin-top:12px">
    ‚è∞ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ {{"%02d"|format(1)}}:00 UTC
  </p>
  {% else %}
  <p class="muted">–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª—å —Ä–µ–≥–∏–æ–Ω–∞ –≤–æ –≤–∫–ª–∞–¥–∫–µ Regions</p>
  {% endif %}
</div>

{% if runs %}
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–†–µ–≥–∏–æ–Ω</th>
      <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
      <th>–ù–∞—á–∞–ª–æ</th>
      <th>–ö–æ–Ω–µ—Ü</th>
      <th>–û—à–∏–±–∫–∞</th>
    </tr>
  </thead>
  <tbody>
    {% for run in runs %}
    <tr>
      <td><a href="/runs/{{run.id}}">{{run.id}}</a></td>
      <td>
        <span class="status status-{{run.status}}">{{run.status}}</span>
      </td>
      <td>{{run.region.name if run.region else '‚Äî'}}</td>
      <td>
        {% if run.total_targets > 0 %}
          <span class="price">{{run.success_count}}</span> / {{run.total_targets}}
          {% if run.fail_count > 0 %}
            <span class="error">({{run.fail_count}} –æ—à–∏–±–æ–∫)</span>
          {% endif %}
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td class="muted">{{run.started_at.strftime('%m-%d %H:%M') if run.started_at else '‚Äî'}}</td>
      <td class="muted">{{run.finished_at.strftime('%m-%d %H:%M') if run.finished_at else '‚Äî'}}</td>
      <td class="error" style="max-width:200px; word-break:break-word">
        {{run.error[:100] if run.error else ''}}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="card muted">–ù–µ—Ç –∑–∞–ø—É—Å–∫–æ–≤</div>
{% endif %}
{% endblock %}
