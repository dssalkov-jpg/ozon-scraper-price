{% extends "layout.html" %}
{% block content %}
<h2>üìä Run #{{run.id if run else '?'}} ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>

{% if run %}
<div class="card">
  <p>
    <strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="status status-{{run.status}}">{{run.status}}</span><br>
    <strong>–†–µ–≥–∏–æ–Ω:</strong> {{run.region.name if run.region else '‚Äî'}}<br>
    <strong>–ù–∞—á–∞–ª–æ:</strong> {{run.started_at.strftime('%Y-%m-%d %H:%M:%S') if run.started_at else '‚Äî'}}<br>
    <strong>–ö–æ–Ω–µ—Ü:</strong> {{run.finished_at.strftime('%Y-%m-%d %H:%M:%S') if run.finished_at else '‚Äî'}}<br>
    <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> {{run.success_count}} —É—Å–ø–µ—à–Ω–æ / {{run.fail_count}} –æ—à–∏–±–æ–∫ –∏–∑ {{run.total_targets}}
  </p>
  {% if run.error %}
  <p class="error"><strong>–û—à–∏–±–∫–∞:</strong> {{run.error}}</p>
  {% endif %}
  <a href="/runs/{{run.id}}/json" target="_blank" class="btn btn-secondary">üì• –°–∫–∞—á–∞—Ç—å JSON</a>
</div>
{% endif %}

{% if points %}
<table>
  <thead>
    <tr>
      <th>–¢–æ–≤–∞—Ä</th>
      <th>–¶–µ–Ω–∞</th>
      <th>–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞</th>
      <th>–° –∫–∞—Ä—Ç–æ–π</th>
      <th>–í –Ω–∞–ª–∏—á–∏–∏</th>
      <th>–û—à–∏–±–∫–∞</th>
    </tr>
  </thead>
  <tbody>
    {% for p in points %}
    <tr>
      <td>
        <strong>{{p.target.name or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}}</strong><br>
        <a href="{{p.target.url}}" target="_blank" class="muted url-cell">{{p.target.url[:60]}}...</a>
      </td>
      <td>
        {% if p.price %}
          <span class="price">{{ "%.2f"|format(p.price / 100) }} ‚ÇΩ</span>
        {% else %}
          <span class="muted">‚Äî</span>
        {% endif %}
      </td>
      <td>
        {% if p.old_price %}
          <span class="price-old">{{ "%.2f"|format(p.old_price / 100) }} ‚ÇΩ</span>
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td>
        {% if p.card_price %}
          {{ "%.2f"|format(p.card_price / 100) }} ‚ÇΩ
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td>{{ "‚úÖ" if p.in_stock else "‚ùå" }}</td>
      <td class="error">{{p.error or ''}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<div class="card muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
{% endif %}

<p style="margin-top:20px"><a href="/runs">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a></p>
{% endblock %}
